{% extends 'landing/base.html' %}
{% load static %}
{% block content %}
    <div class="rest-bck">
        <img src="{{ store.image.url }}" alt="">
        <div class="topstroke">
            <p class="devtime">
                <!-- <i class="fa fa-bicycle" aria-hidden="true" style="color: #fff; padding-right: 5px;"></i> -->
                Среднее время доставки
            <p class="time">20-30 мин.</p></p>
            <p class="otkr"> Открыто сегодня с:
            <p class="opentime">{{ store.time_open }} - {{ store.time_closed }}</p></p>
            <p class="cart"><i class="fa fa-shopping-cart" aria-hidden="true" style="padding-right: 8px;"></i> <a
                    href="{% url 'cart_detail' store.slug %}">Корзина</a>
            </p>
        </div>

        <div class="midstroke">
            <p class="restname">{{ store.name }}</p>
            <p class="slogan">{{ store.description }}</p>
            <div class="cash" style="display: inline-flex; font-weight: bold;">
                <p class="cash1">$$
                <p class="cash2">$$</p></p>
            </div>
        </div>
    </div>

    <div class="menubody">
        <div class="menutop" style="display: inline-flex;">
            <p class="rate1"><i class="fa fa-star-half-o" aria-hidden="true"></i> {{ store.average_rating }} из 5</p>
            <a type="button" href="{% url 'add_wishlist' %}?store_id={{ store.id }}" class="izbr"><i
                    class="fa fa-heart-o" aria-hidden="true"
                    style="font-size: 18px; padding-right: 5px;"></i> Добавить в избранное
            </a>
            <button class="izbr1"><i class="fa fa-heart-o" aria-hidden="true" style="font-size: 18px;"></i></button>
                        <form method="get">
            <input type="search" class="menusrch" placeholder="Поиск по меню..." name="q" value="{{ request.GET.q }}">
                        </form>


        </div>

        <div class="menu-h">
            <h3>ВЫГОДНЫЕ ПРЕДЛОЖЕННИЯ</h3>
            <div class="m1" style="display: inline-flex;">
                <div class="menu">
                    {% for product in products %}
                        <div class="pos">
                            <div class="pos-body">
                                <div class="pos-info" style="">
                                    <h5 class="name">
                                        <a href="{% url 'cart_add' product.id %}"
                                           style="text-decoration: none; color: black"><i>+++</i></a>
                                        {{ product.name }}
                                    </h5>
                                    <p class="info1">{{ product.description }}</p>
                                    <p class="price" s>{{ product.price }} ₸</p>
                                </div>
                                <div class="pos-img" style="">
                                    <img src="{{ product.image.url }}" style="" alt="">
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <div class="rest-inf">
                    <div class="infbody">
                        <h4>О ресторане</h4>
                        <h5>Адрес</h5>
                        <p>{{ store.address }}</p>
                        <br>
                        <h5>Время работы</h5>
                        <p>Ежедневно {{ store.time_open }} - {{ store.time_closed }}</p>
                        <br>
                        <p>При наличии аллергии или диетических ограничений, сообщите об этом ресторану. Он предоставит
                            подробную информацию о блюдах.</p>
                    </div>
                </div>

            </div>
        </div>
        <div>
            <input id="changeSize" type="button" value="Развернуть"/>
            <div id="map" style="width: 100%; height: 300px;"></div>


        <div>
            <h1>Отзывы</h1>
            {% for review in reviews %}
                Рейтинг: {{ review.rating }}
                <br>
                Пользователь: {{ review.user }}
                <br>
                {% if review.comment %}
                    Комментария: {{ review.comment }}
                    <br>
                {% endif %}

                Дата: {{ review.pub_date }}
                <br>
                <br>
            {% endfor %}
        </div>

    </div>
    <script src="https://maps.api.2gis.ru/2.0/loader.js?pkg=full"></script>
{#    <script src="https://maps.api.2gis.ru/2.0/loader.js"></script>#}

    <script type="text/javascript">

        {#var changeSizeButton = document.getElementById('changeSize');#}
        {##}
        {#DG.then(function () {#}
        {#    var map, enabled = false#}
        {#    map = DG.map('map', {#}
        {#        center: [{{ store.latitude }}, {{ store.longitude }}],#}
        {#        zoom: 18,#}
        {#closePopupOnClick: false,#}
        {#        animate: true#}
        {##}
        {##}
        {#    });#}
        {##}
        {#DG.marker([43.23317, 76.957453]).addTo(map);#}
        {#DG.popup({closeButton: false}).setLatLng([{{ store.latitude }}, {{ store.longitude }}]).setContent('{{ store.name }}').addTo(map);#}
        {#    changeSizeButton.onclick = function () {#}
        {#        var mapDiv = document.getElementById('map');#}
        {#        mapDiv.style.height = (enabled ? '200' : '400') + 'px';#}
        {#        // обновление карты#}
        {#        map.invalidateSize();#}
        {#    }#}
        {# }); #}
        var changeSizeButton = document.getElementById('changeSize');

        DG.then(function () {
            var map,
                enabled = false;

            map = DG.map('map', {
                center: [{{ store.latitude }}, {{ store.longitude }}],
                zoom: 18,
                animate: true,
                closePopupOnClick: false,
                poi: false,
                {#maxBounds: [#}
                {#        [{{ store.latitude }}, {{ store.longitude }}],#}
                {#        [{{ store.latitude }}, {{ store.longitude }}]#}
                {#    ],#}
                {#minZoom: 13,#}
                {#maxZoom: 18#}

            });
            DG.popup({closeButton: false}).setLatLng([{{ store.latitude }}, {{ store.longitude }}]).setContent('{{ store.name }}').addTo(map);

            changeSizeButton.onclick = function () {

                var mapDiv = document.getElementById('map');
                console.log(mapDiv.style.height, enabled)
                if(mapDiv.style.height == '600px'){
                    enabled = true;
                }
                else{
                    enabled = false;
                }
                mapDiv.style.height = (enabled ? '300' : '600') + 'px';
                // обновление карты
                map.invalidateSize();

                if(mapDiv.style.height == '600px'){
                    changeSizeButton.value = 'Свернуть';
                }
                else{
                    changeSizeButton.value = 'Развернуть';
                }
            }
        });
    </script>

{% endblock %}


